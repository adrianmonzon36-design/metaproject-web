<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaProject | Acceso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --apple-bg: #F5F5F7; --apple-card: #FFFFFF; }
        * { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        body { background-color: var(--apple-bg); color: #1D1D1F; margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }

        .apple-card { background: var(--apple-card); border-radius: 32px; box-shadow: 0 20px 60px rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.5); position: relative; z-index: 10; }
        .input-apple { width: 100%; background: #F5F5F7; padding: 16px 20px 16px 44px; border-radius: 16px; border: 2px solid transparent; outline: none; font-size: 14px; font-weight: 500; transition: all 0.2s ease; }
        .input-apple:focus { background: #FFFFFF; border-color: #E5E5EA; box-shadow: 0 4px 12px rgba(0,0,0,0.02); }
        
        .form-view { display: none; opacity: 0; transition: opacity 0.4s ease; }
        .form-view.active { display: block; opacity: 1; animation: fadeIn 0.4s ease forwards; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .toggle-btn { position: relative; display: flex; background: #F5F5F7; border-radius: 100px; padding: 4px; margin-bottom: 32px; }
        .toggle-option { flex: 1; text-align: center; padding: 10px 0; font-size: 12px; font-weight: 700; color: #8E8E93; cursor: pointer; z-index: 10; transition: color 0.3s ease; }
        .toggle-option.active { color: #1D1D1F; }
        .toggle-pill { position: absolute; top: 4px; bottom: 4px; left: 4px; width: calc(50% - 4px); background: #FFFFFF; border-radius: 100px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1; }
        [data-state="register"] .toggle-pill { transform: translateX(100%); }

        /* Estilo para el Custom Alert (iOS Style) */
        #customAlert { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background: rgba(29, 29, 31, 0.9); backdrop-filter: blur(20px); color: white; padding: 12px 24px; border-radius: 20px; font-size: 13px; font-weight: 600; z-index: 2000; transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1); box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 10px; width: fit-content; min-width: 280px; }
        #customAlert.show { top: 30px; }
        .alert-icon-error { color: #FF453A; }
        .alert-icon-success { color: #32D74B; }

        /* Modales */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 1200; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: white; width: 100%; max-width: 400px; border-radius: 28px; padding: 32px; position: relative; }

        .bg-blob { position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0.6; z-index: 1; animation: float 10s infinite ease-in-out alternate; }
        .blob-1 { width: 300px; height: 300px; background: #E5F1FF; top: -100px; right: -100px; }
        .blob-2 { width: 250px; height: 250px; background: #F3E8FF; bottom: -50px; left: -100px; }
        @keyframes float { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(20px, -20px) scale(1.05); } }
    </style>
</head>
<body class="p-6">

    <div id="customAlert">
        <div id="alertIcon"></div>
        <span id="alertMessage"></span>
    </div>

    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>

    <div id="forgotModal" class="modal-overlay">
        <div class="modal-content relative">
            <button onclick="closeModal('forgotModal')" class="absolute top-6 right-6 text-gray-400 hover:text-black"><i data-lucide="x" class="w-5 h-5"></i></button>
            <div class="w-12 h-12 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mb-4"><i data-lucide="key" class="w-6 h-6"></i></div>
            <h3 class="text-xl font-bold mb-2">Recuperar acceso</h3>
            <p class="text-xs text-gray-500 mb-6">Ingresa tu correo para recibir un enlace de recuperación.</p>
            <input type="email" id="recoveryEmail" placeholder="tu@correo.com" class="input-apple mb-4">
            <button onclick="realRecovery(this)" class="w-full bg-black text-white py-3.5 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-all">Enviar instrucciones</button>
        </div>
    </div>

    <div class="apple-card w-full max-w-md p-8 md:p-10">
        <div class="text-center mb-8">
            <div class="w-12 h-12 bg-black text-white rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg"><i data-lucide="layers" class="w-6 h-6"></i></div>
            <h1 class="text-2xl font-black tracking-tight">MetaProject</h1>
        </div>

        <div class="toggle-btn" id="formToggle" data-state="login">
            <div class="toggle-pill"></div>
            <div class="toggle-option active" onclick="switchForm('login')">Iniciar Sesión</div>
            <div class="toggle-option" onclick="switchForm('register')">Registrarse</div>
        </div>

        <div id="loginView" class="form-view active">
            <div class="space-y-5">
                <div class="relative">
                    <i data-lucide="mail" class="w-4 h-4 text-gray-400 absolute left-4 top-1/2 -translate-y-1/2"></i>
                    <input type="email" id="loginEmail" placeholder="tu@correo.com" class="input-apple pl-11">
                </div>
                <div class="relative">
                    <i data-lucide="lock" class="w-4 h-4 text-gray-400 absolute left-4 top-1/2 -translate-y-1/2"></i>
                    <input type="password" id="loginPassword" placeholder="••••••••" class="input-apple pl-11">
                    <button onclick="openModal('forgotModal')" class="absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-bold text-blue-500">¿Olvidaste?</button>
                </div>
            </div>
            <button onclick="realLogin(this)" class="w-full bg-black text-white py-4 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-all mt-8 flex items-center justify-center gap-2">
                Acceder <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </button>
        </div>

        <div id="registerView" class="form-view">
            <div class="space-y-4">
                <input type="text" id="regName" placeholder="Nombre completo" class="input-apple">
                <input type="email" id="regEmail" placeholder="Correo electrónico" class="input-apple">
                <input type="password" id="regPassword" placeholder="Contraseña (mín 6)" class="input-apple">
            </div>
            <div class="mt-6 flex items-start gap-3 bg-blue-50/50 p-4 rounded-xl border border-blue-100 text-[10px] text-gray-600">
                <i data-lucide="shield-alert" class="w-4 h-4 text-blue-500 shrink-0"></i>
                <p>Tu cuenta quedará <span class="font-bold">Pendiente</span> hasta que confirmes tu correo y el administrador te apruebe.</p>
            </div>
            <button onclick="realRegister(this)" class="w-full bg-black text-white py-4 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-all mt-6">Solicitar Acceso</button>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-100 flex flex-col items-center gap-3">
            <p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest text-center">AMG ©️ 2026</p>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // CONEXIÓN SUPABASE
        const supabaseUrl = 'https://tvdkwqbagiccatqrillg.supabase.co';
        const supabaseKey = 'sb_publishable_N9RM5G0ySNDSohmjI49Maw_HwOPq-b2';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // FUNCIÓN MAESTRA DE ALERTAS
        function showAlert(msg, type = 'error') {
            const alert = document.getElementById('customAlert');
            const icon = document.getElementById('alertIcon');
            const message = document.getElementById('alertMessage');
            
            message.innerText = msg;
            icon.innerHTML = type === 'error' 
                ? '<i data-lucide="x-circle" class="alert-icon-error"></i>' 
                : '<i data-lucide="check-circle" class="alert-icon-success"></i>';
            
            lucide.createIcons();
            alert.classList.add('show');
            
            setTimeout(() => { alert.classList.remove('show'); }, 4000);
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function switchForm(state) {
            const toggle = document.getElementById('formToggle');
            toggle.setAttribute('data-state', state);
            document.querySelectorAll('.toggle-option').forEach(o => o.classList.remove('active'));
            event.target.classList.add('active');
            
            if(state === 'login'){
                document.getElementById('registerView').classList.remove('active');
                setTimeout(() => { document.getElementById('registerView').style.display='none'; document.getElementById('loginView').style.display='block'; setTimeout(() => document.getElementById('loginView').classList.add('active'),10); },200);
            } else {
                document.getElementById('loginView').classList.remove('active');
                setTimeout(() => { document.getElementById('loginView').style.display='none'; document.getElementById('registerView').style.display='block'; setTimeout(() => document.getElementById('registerView').classList.add('active'),10); },200);
            }
        }

        async function realLogin(btn) {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            if(!email || !password) return showAlert("Ingresa todos los campos");

            const original = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Autenticando...`;
            lucide.createIcons();
            btn.disabled = true;

            const { data, error } = await _supabase.auth.signInWithPassword({ email, password });

            if (error) {
                showAlert(error.message === 'Invalid login credentials' ? "Correo o contraseña incorrectos" : error.message);
                btn.disabled = false;
                btn.innerHTML = original;
                lucide.createIcons();
            } else {
                window.location.href = 'index.html';
            }
        }

        async function realRegister(btn) {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            if(!name || !email || !password) return showAlert("Completa todos los campos");

            btn.disabled = true;
            const { data, error } = await _supabase.auth.signUp({ email, password, options: { data: { full_name: name } } });

            if (error) {
                showAlert(error.message);
                btn.disabled = false;
            } else {
                showAlert("¡Correo enviado! Confirma tu mail para activar la cuenta", "success");
                switchForm('login');
            }
        }

        async function realRecovery(btn) {
            const email = document.getElementById('recoveryEmail').value;
            if(!email) return showAlert("Ingresa tu correo");
            const { error } = await _supabase.auth.resetPasswordForEmail(email);
            if(error) showAlert(error.message);
            else { showAlert("Enlace enviado con éxito", "success"); closeModal('forgotModal'); }
        }
    </script>
</body>
</html>
