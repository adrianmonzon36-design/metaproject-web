<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>METAPROJECT - Adri√°n Monz√≥n</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f6f8fa; font-family: 'Inter', sans-serif; color: #1e293b; }
        .sidebar { width: 260px; background: white; border-right: 1px solid #e2e8f0; position: fixed; height: 100vh; transition: 0.3s; z-index: 100; left: 0; }
        .sidebar.closed { left: -260px; }
        .main-content { margin-left: 260px; padding: 24px; transition: 0.3s; min-height: 100vh; }
        .main-content.expanded { margin-left: 0; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); z-index: 200; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal.active { display: flex; }
        #overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 90; }
        #overlay.active { display: block; }
        .nav-link { display: flex; align-items: center; padding: 12px 16px; margin: 4px 12px; border-radius: 8px; color: #64748b; font-size: 0.85rem; font-weight: 500; cursor: pointer; }
        .nav-link.active { background: #e0e7ff; color: #4338ca; font-weight: 700; }
        @media (max-width: 1024px) { .sidebar { left: -260px; } .sidebar.open { left: 0; } .main-content { margin-left: 0; } }
    </style>
</head>
<body>

    <div id="overlay" onclick="toggleMenu()"></div>

    <div id="view-login" class="fixed inset-0 bg-white z-[300] flex flex-col items-center justify-center p-6">
        <h1 class="text-4xl font-bold tracking-tighter mb-12">METAPROJECT</h1>
        <div class="w-full max-w-sm space-y-4">
            <input type="text" id="login-id" placeholder="N√∫mero de empleado" class="w-full border p-4 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500">
            <input type="password" id="login-pass" placeholder="Contrase√±a" class="w-full border p-4 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500">
            <button onclick="handleLogin()" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg">Continuar</button>
            <div class="flex justify-between text-[10px] font-bold text-gray-400 uppercase pt-4">
                <button onclick="openModal('modal-registro-cuenta')">Crear cuenta</button>
                <button onclick="alert('Sistema de recuperaci√≥n v√≠a correo')">¬øOlvidaste tu contrase√±a?</button>
            </div>
            <button class="w-full text-[10px] text-gray-400 underline mt-4">Aviso de Privacidad</button>
        </div>
        <footer class="absolute bottom-8 text-[10px] text-gray-300 uppercase tracking-widest">Derechos reservados por AMonzon</footer>
    </div>

    <aside id="sidebar" class="sidebar closed">
        <div class="p-8 border-b border-gray-50 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-900 tracking-tighter">METAPROJECT</h1>
            <button onclick="toggleMenu()" class="lg:hidden text-gray-400">‚úï</button>
        </div>
        <nav class="mt-4">
            <div onclick="showTab('dashboard')" class="nav-link active tab-btn" id="btn-dashboard">üìä Dashboard</div>
            <div onclick="showTab('requerimientos')" class="nav-link tab-btn" id="btn-requerimientos">üìù Requerimientos</div>
            <div onclick="showTab('kanban')" class="nav-link tab-btn" id="btn-kanban">üìã Kanban</div>
            <div onclick="showTab('roadmap')" class="nav-link tab-btn" id="btn-roadmap">üìÖ Hoja de Ruta</div>
            <div onclick="showTab('presupuesto')" class="nav-link tab-btn" id="btn-presupuesto">üí∞ Presupuesto</div>
            <div onclick="showTab('excel')" class="nav-link tab-btn" id="btn-excel">üì• Carga Excel / Gemini</div>
            <div onclick="showTab('admin')" class="nav-link tab-btn" id="btn-admin">‚öôÔ∏è Administraci√≥n</div>
        </nav>
        <button onclick="location.reload()" class="absolute bottom-8 left-8 text-[10px] font-bold text-rose-500">SALIR</button>
    </aside>

    <main id="main-content" class="main-content expanded">
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center gap-4">
                <button onclick="toggleMenu()" class="p-2 bg-white rounded-lg shadow-sm border">‚ò∞</button>
                <h2 id="tab-title" class="text-xl font-bold text-gray-800 uppercase">DASHBOARD</h2>
            </div>
        </header>

        <div id="view-dashboard" class="tab-view">
            <div class="flex justify-end mb-4">
                <button onclick="openModal('modal-actividad')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-xs font-bold">+ NUEVA ACTIVIDAD</button>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-3xl border shadow-sm flex flex-col items-center">
                    <canvas id="donaChart" width="150" height="150"></canvas>
                    <p class="mt-4 text-[10px] font-bold text-gray-400 uppercase">Avance Total</p>
                </div>
                <div class="lg:col-span-2 grid grid-cols-2 gap-4" id="stats-container">
                    </div>
            </div>
            <div class="bg-white p-6 rounded-3xl border shadow-sm">
                <h3 class="text-xs font-bold text-gray-400 uppercase mb-4 italic">Cronograma Ejecutivo</h3>
                <div id="gantt-container" class="space-y-4">
                    </div>
            </div>
        </div>

        <div id="view-requerimientos" class="tab-view hidden">
            <div class="flex justify-end mb-4">
                <button onclick="openModal('modal-req')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-xs font-bold">+ REGISTRAR REQ</button>
            </div>
            <div class="bg-white rounded-2xl border shadow-sm overflow-hidden">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 text-[10px] font-bold text-gray-400 uppercase">
                        <tr><th class="p-4">ID</th><th class="p-4">Descripci√≥n</th><th class="p-4 text-center">Acciones</th></tr>
                    </thead>
                    <tbody id="req-table-body" class="divide-y"></tbody>
                </table>
            </div>
        </div>

        <div id="view-roadmap" class="tab-view hidden">
            <div class="flex justify-end mb-4">
                <button onclick="openModal('modal-hito')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-xs font-bold">+ NUEVO HITO</button>
            </div>
            <div class="bg-white rounded-2xl border shadow-sm overflow-hidden">
                <table class="w-full text-sm">
                    <thead class="bg-gray-50 text-[10px] font-bold text-gray-400 uppercase">
                        <tr><th class="p-4 text-left">Hito</th><th class="p-4">Grupo</th><th class="p-4">Inicio</th><th class="p-4">Fin</th><th class="p-4 text-center">Acciones</th></tr>
                    </thead>
                    <tbody id="hito-table-body" class="divide-y"></tbody>
                </table>
            </div>
        </div>

        <div id="view-presupuesto" class="tab-view hidden">
            <div class="flex justify-end mb-4">
                <button onclick="openModal('modal-gasto')" class="bg-emerald-600 text-white px-4 py-2 rounded-lg text-xs font-bold">+ AGREGAR GASTO</button>
            </div>
            <div class="bg-white p-12 rounded-3xl border shadow-sm text-center mb-6">
                <p class="text-[10px] font-bold text-gray-400 uppercase">Control de presupuesto</p>
                <p id="total-presupuesto" class="text-5xl font-black text-indigo-600">$0.00</p>
            </div>
            <div id="lista-gastos" class="space-y-2"></div>
        </div>

        <div id="view-excel" class="tab-view hidden">
            <div class="max-w-xl mx-auto bg-white p-12 rounded-3xl border-2 border-dashed text-center">
                <h3 class="font-bold mb-4 uppercase text-sm tracking-widest italic">Carga de Excel</h3>
                <p class="text-xs text-gray-400 mb-8 font-bold">IMPORTACI√ìN MASIVA DE HITOS</p>
                <input type="file" id="excel-file" class="hidden" onchange="processExcel()">
                <label for="excel-file" class="bg-indigo-600 text-white px-10 py-4 rounded-xl font-bold text-xs cursor-pointer inline-block">SUBIR ARCHIVO .XLSX</label>
                <div id="gemini-ai" class="hidden mt-8 p-6 bg-indigo-900 text-white rounded-2xl text-left">
                    <p class="text-[10px] font-bold uppercase mb-2 italic">‚ú® An√°lisis Gemini v3.0</p>
                    <p id="gemini-text" class="text-xs italic"></p>
                </div>
            </div>
        </div>

        <div id="view-admin" class="tab-view hidden">
            <div class="bg-white rounded-2xl border p-6">
                <h3 class="text-xs font-bold text-gray-400 uppercase mb-4 italic">Log de Trazabilidad</h3>
                <div id="log-container" class="space-y-3 text-[10px]"></div>
            </div>
        </div>
    </main>

    <div id="modal-registro-cuenta" class="modal">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm">
            <h3 class="font-bold mb-4 uppercase text-center italic">Crear Cuenta</h3>
            <div class="space-y-3">
                <input type="text" id="reg-nombre" placeholder="Nombre completo" class="w-full border p-3 rounded-xl text-sm outline-none">
                <input type="text" id="reg-id" placeholder="N√∫mero de empleado" class="w-full border p-3 rounded-xl text-sm outline-none">
                <input type="password" id="reg-pass" placeholder="Contrase√±a" class="w-full border p-3 rounded-xl text-sm outline-none">
                <button onclick="saveUser()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold uppercase text-xs">Publicar Cuenta</button>
            </div>
        </div>
    </div>

    <div id="modal-hito" class="modal">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm text-center">
            <h3 class="font-bold mb-6 italic">Nombre Hito</h3>
            <input type="text" id="hito-nombre" placeholder="Nombre del hito..." class="w-full border p-3 rounded-xl mb-4 text-sm outline-none">
            <div class="grid grid-cols-2 gap-2 mb-4">
                <input type="date" id="hito-inicio" class="border p-3 rounded-xl text-xs">
                <input type="date" id="hito-fin" class="border p-3 rounded-xl text-xs">
            </div>
            <select id="hito-grupo" class="w-full border p-3 rounded-xl mb-6 text-xs bg-gray-50 outline-none">
                <option value="UPAX">UPAX</option>
                <option value="UiX/UX">UiX/UX</option>
                <option value="Despidalia">Despidalia</option>
                <option value="Todos">Todos</option>
            </select>
            <button onclick="saveHito()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold uppercase text-xs">Publicar</button>
        </div>
    </div>

    <div id="modal-actividad" class="modal">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm text-center">
            <h3 class="font-bold mb-6 italic">Nueva Actividad</h3>
            <input type="text" id="act-nombre" placeholder="Nombre de la actividad..." class="w-full border p-3 rounded-xl mb-4 text-sm outline-none">
            <div class="grid grid-cols-2 gap-2 mb-6">
                <input type="date" id="act-inicio" class="border p-3 rounded-xl text-xs">
                <select id="act-status" class="border p-3 rounded-xl text-[10px] bg-gray-50">
                    <option value="En tiempo">En tiempo</option>
                    <option value="Pendiente">Pendiente</option>
                    <option value="Atrasado">Atrasado</option>
                    <option value="Completado">Completado</option>
                </select>
            </div>
            <button onclick="saveActividad()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold uppercase text-xs">Publicar</button>
        </div>
    </div>

    <div id="modal-gasto" class="modal">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm">
            <h3 class="font-bold mb-4 uppercase italic">Agregar Gasto</h3>
            <input type="text" id="gasto-concepto" placeholder="Concepto..." class="w-full border p-3 rounded-xl mb-3 text-sm">
            <input type="number" id="gasto-monto" placeholder="Monto $" class="w-full border p-3 rounded-xl mb-6 text-sm">
            <button onclick="saveGasto()" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold uppercase text-xs">Registrar</button>
        </div>
    </div>

    <div id="modal-req" class="modal">
        <div class="bg-white p-8 rounded-3xl w-full max-w-sm">
            <h3 class="font-bold mb-4 uppercase italic">Nuevo Requerimiento</h3>
            <textarea id="req-desc" class="w-full border p-3 rounded-xl text-sm mb-4 h-24" placeholder="Escribe el requerimiento..."></textarea>
            <button onclick="saveReq()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold uppercase text-xs">Guardar Requerimiento</button>
        </div>
    </div>

    <script>
        // MOTOR DE DATOS (LOCALSTORAGE)
        let db = JSON.parse(localStorage.getItem('metaproject_db')) || { users: [], hitos: [], actividades: [], reqs: [], gastos: [], logs: [] };

        function updateDB() { 
            localStorage.setItem('metaproject_db', JSON.stringify(db)); 
            renderAll(); 
        }

        function addLog(msg) {
            db.logs.unshift({ msg, date: new Date().toLocaleString() });
            updateDB();
        }

        // LOGIN
        function handleLogin() {
            const id = document.getElementById('login-id').value;
            if(id) {
                document.getElementById('view-login').style.display = 'none';
                toggleMenu();
                addLog(`Usuario ${id} inici√≥ sesi√≥n.`);
            }
        }

        function saveUser() {
            const nombre = document.getElementById('reg-nombre').value;
            const id = document.getElementById('reg-id').value;
            if(nombre && id) {
                db.users.push({nombre, id});
                addLog(`Nueva cuenta creada: ${nombre}`);
                closeModal();
            }
        }

        // HITOS
        function saveHito() {
            const hito = {
                nombre: document.getElementById('hito-nombre').value,
                inicio: document.getElementById('hito-inicio').value,
                fin: document.getElementById('hito-fin').value,
                grupo: document.getElementById('hito-grupo').value
            };
            db.hitos.push(hito);
            addLog(`Hito registrado: ${hito.nombre}`);
            closeModal();
            updateDB();
        }

        // ACTIVIDADES (DASHBOARD)
        function saveActividad() {
            const act = {
                nombre: document.getElementById('act-nombre').value,
                inicio: document.getElementById('act-inicio').value,
                status: document.getElementById('act-status').value
            };
            db.actividades.push(act);
            addLog(`Actividad registrada: ${act.nombre}`);
            closeModal();
            updateDB();
        }

        // GASTOS
        function saveGasto() {
            const concepto = document.getElementById('gasto-concepto').value;
            const monto = parseFloat(document.getElementById('gasto-monto').value);
            if(concepto && monto) {
                db.gastos.push({concepto, monto});
                addLog(`Gasto registrado: ${concepto} ($${monto})`);
                closeModal();
                updateDB();
            }
        }

        // REQUERIMIENTOS
        function saveReq() {
            const desc = document.getElementById('req-desc').value;
            if(desc) {
                db.reqs.push({id: 'REQ-' + (db.reqs.length + 1), desc});
                addLog(`Requerimiento creado`);
                closeModal();
                updateDB();
            }
        }

        // RENDERS
        function renderAll() {
            // Stats Dashboard
            document.getElementById('stats-container').innerHTML = `
                <div class="bg-white p-6 rounded-3xl border shadow-sm text-center"><p class="text-[10px] font-bold text-gray-400 uppercase">Actividades</p><p class="text-3xl font-black">${db.actividades.length}</p></div>
                <div class="bg-white p-6 rounded-3xl border shadow-sm text-center"><p class="text-[10px] font-bold text-gray-400 uppercase">Hitos</p><p class="text-3xl font-black">${db.hitos.length}</p></div>
            `;

            // Gantt Dashboard
            document.getElementById('gantt-container').innerHTML = db.actividades.map(a => `
                <div class="h-10 bg-gray-50 rounded-xl relative flex items-center px-4 overflow-hidden border">
                    <div class="absolute inset-y-0 left-0 bg-indigo-600" style="width: ${a.status === 'Completado' ? '100%' : '50%'}"></div>
                    <span class="relative z-10 text-[9px] font-bold text-white uppercase italic">${a.nombre} - ${a.status}</span>
                </div>
            `).join('');

            // Tabla Hitos
            document.getElementById('hito-table-body').innerHTML = db.hitos.map((h, i) => `
                <tr>
                    <td class="p-4 font-bold">${h.nombre}</td>
                    <td class="p-4 text-[10px] italic font-bold">${h.grupo}</td>
                    <td class="p-4 text-[10px]">${h.inicio}</td>
                    <td class="p-4 text-[10px]">${h.fin}</td>
                    <td class="p-4 text-center space-x-2 text-lg">
                        <button class="text-blue-500">‚úé</button>
                        <button onclick="db.hitos.splice(${i},1); updateDB();" class="text-rose-500">üóë</button>
                    </td>
                </tr>
            `).join('');

            // Tabla Req
            document.getElementById('req-table-body').innerHTML = db.reqs.map((r, i) => `
                <tr><td class="p-4 font-bold text-indigo-600">${r.id}</td><td class="p-4">${r.desc}</td><td class="p-4 text-center text-lg"><button class="text-blue-500">‚úé</button> <button onclick="db.reqs.splice(${i},1); updateDB();" class="text-rose-500">üóë</button></td></tr>
            `).join('');

            // Presupuesto
            const total = db.gastos.reduce((acc, curr) => acc + curr.monto, 0);
            document.getElementById('total-presupuesto').innerText = `$${total.toLocaleString()}`;
            document.getElementById('lista-gastos').innerHTML = db.gastos.map(g => `
                <div class="bg-white p-4 border rounded-xl flex justify-between items-center text-sm font-bold">
                    <span>${g.concepto}</span><span class="text-indigo-600">$${g.monto}</span>
                </div>
            `).join('');

            // Logs
            document.getElementById('log-container').innerHTML = db.logs.map(l => `
                <div class="flex justify-between border-b pb-1 text-gray-400 italic"><span>${l.msg}</span><span>${l.date}</span></div>
            `).join('');
        }

        // UI HELPERS
        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('closed');
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('main-content').classList.toggle('expanded');
            document.getElementById('overlay').classList.toggle('active');
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-view').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('view-' + tabId).classList.remove('hidden');
            document.getElementById('btn-' + tabId).classList.add('active');
            document.getElementById('tab-title').innerText = tabId.toUpperCase();
            if(window.innerWidth < 1024) toggleMenu();
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); }

        function processExcel() {
            document.getElementById('gemini-ai').classList.remove('hidden');
            document.getElementById('gemini-text').innerText = "Adri√°n, analic√© el archivo. He detectado 5 hitos nuevos para el grupo UPAX. La coherencia de fechas es correcta.";
            addLog("Excel analizado por Gemini.");
        }

        // INICIALIZACI√ìN
        window.onload = () => {
            renderAll();
            const ctx = document.getElementById('donaChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: { datasets: [{ data: [89, 11], backgroundColor: ['#4f46e5', '#f1f5f9'], borderWidth: 0 }] },
                options: { cutout: '80%', plugins: { legend: { display: false } } }
            });
        };
    </script>
</body>
</html>
